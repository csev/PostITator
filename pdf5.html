<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>PDF.js &#39;Hello, base64!&#39; example</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">


  <script
    type="text/javascript"
    src="/js/lib/dummy.js"
    
  ></script>

    <link rel="stylesheet" type="text/css" href="/css/result-light.css">


  <style id="compiled-css" type="text/css">
      .pdf-page {
  border: 1px solid black;
  direction: ltr;
}
  </style>


        <link href="http://localhost:8888/tsugi-static/js/jquery-ui-1.11.4/jquery-ui.min.css" rel="stylesheet">


<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
<link rel='stylesheet' href='https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css'>
<link rel='stylesheet' href='index3.css'>


    <script type="text/javascript">//<![CDATA[

        // https://stackoverflow.com/a/19099203/1994792
    window.onload=function(){

// If absolute URL from the remote server is provided, configure the CORS
// header on that server.
// var url = 'https://raw.githubusercontent.com/mozilla/pdf.js/ba2edeae/examples/learning/helloworld.pdf';
var url = 'pythonlearn.pdf';

// Loaded via <script> tag, create shortcut to access PDF.js exports.
var pdfjsLib = window['pdfjs-dist/build/pdf'];

// The workerSrc property shall be specified.
// pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@2.2.228/build/pdf.worker.js';

// https://www.sitepoint.com/custom-pdf-rendering/
function handlePages(page)
{
    //This gives us the page's dimensions at full scale
    var viewport = page.getViewport({ scale: 1.5, rotation: 0 });

    //We'll create a canvas for each page to draw it on
    var canvas = document.createElement( "canvas" );
    canvas.style.display = "block";
    var context = canvas.getContext('2d');
    canvas.height = viewport.height;
    canvas.width = viewport.width;
    canvas.setAttribute('class', 'pdf-page');

    //Draw it on the canvas
    page.render({canvasContext: context, viewport: viewport});

    //Add it to the web page
    document.body.appendChild( canvas );

    //Move to next page
    currPage++;
    if ( thePDF !== null && currPage <= numPages )
    {
        thePDF.getPage( currPage ).then( handlePages );
    }
}


// Asynchronous download of PDF
var currPage = 1; //Pages are 1-based not 0-based
var numPages = 0;
var thePDF = null;

    var loadingTask = pdfjsLib.getDocument(url);
    loadingTask.promise.then(function(pdf) {
        console.log('PDF loaded');

        //Set PDFJS global object (so we can easily access in our page functions
        thePDF = pdf;

        //How many pages it has
        numPages = pdf.numPages;

        //Start with first page
        pdf.getPage( 1 ).then( handlePages );

}, function (reason) {
  // PDF loading error
  console.error(reason);
});

}

  //]]></script>

</head>
<body>
<div id="button_div">
    <a href="javascript:;" class="button" id="prev_note">&lt;</a>
    <a href="javascript:;" class="button" id="add_new">Add</a>
    <a href="javascript:;" class="button" id="next_note">&gt;</a>
</div>
<div id="board" style="position: absolute; top: 1; left: 1; width: 100%;">
</div>
<script src="https://unpkg.com/pdfjs-dist@2.2.228/build/pdf.js"></script>

<script src="http://localhost:8888/tsugi-static/js/jquery-1.11.3.js"></script>
<script src="http://localhost:8888/tsugi-static/js/jquery-ui-1.11.4/jquery-ui.min.js"></script>
<script src='index3.js'></script>

<script>
    function moveNote(forward) {
        var sct = $(document).scrollTop();
        console.log('nextNote', sct);
        var current = false;
        $('.current').each(function(i, obj) {
            if ( ! current ) current = obj;
        });
        var currentpos = 0;
        if ( current ) {
            currentpos = (current.offsetTop * 5000 ) * current.offsetLeft;
        }
        console.log('currentpos', currentpos);
        var first = false;
        var firstpos = false;
        var last = false;
        var lastpos = false;
        var prev = false;
        var prevpos = false;
        var next = false;
        var nextpos = false;
        $('.note').each(function(i, obj) {
            console.log(i,obj);
            pos = (obj.offsetTop * 5000 ) * obj.offsetLeft;
            if ( $(obj).hasClass('current') ) return;
            if ( ! lastpos || pos > lastpos ) {
                last = obj;
                lastpos = pos;
            }
            if ( ! firstpos || pos > firstpos ) {
                first = obj;
                firstpos = pos;
            }
            if ( (! prevpos && pos < currentpos ) || ( prevpos && pos > prevpos ) ) {
                prev = obj
                prevpos = pos;
            }
            if ( (! nextpos && pos > currentpos ) || ( nextpos && pos < nextpos ) ) {
                next = obj
                nextpos = pos;
            }
            console.log(currentpos, pos, prevpos, nextpos);
        });
        console.log('first, prev, current, next, last');
        console.log(first, prev, current, next, last);
        // https://stackoverflow.com/a/56687659/1994792
        if ( ! next ) next = first;
        if ( ! prev ) prev = last;
        if ( forward && next ) {
            console.log('Forward');
            next.scrollIntoView({ behavior: 'smooth' });
            $(next).addClass('current');
        }
        if ( ! forward && prev ) {
            console.log('Backward');
            prev.scrollIntoView({ behavior: 'smooth' });
            $(prev).addClass('current');
        }
        if ( current ) $(current).removeClass('current');
    }
    function nextNote() {
        moveNote(true);
    }
    function prevNote() {
        moveNote(false);
    }
$(document).ready(function () {

  $("#board").height($(document).height());

  $("#add_new").click(newNote);
  $("#prev_note").click(prevNote);
  $("#next_note").click(nextNote);

  $('.remove').click(deleteNote);
  newNote();

  return false;
});
//# sourceURL=pen.js
    </script>
</body>
